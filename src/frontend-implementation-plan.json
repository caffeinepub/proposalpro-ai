{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Stabilize Generate flow by fixing BigInt/plan normalization and React crash",
  "requirements": [
    {
      "id": "REQ-10",
      "summary": "Fix the /generate runtime crash after clicking “Generate Proposals” so generation completes and Generated Content renders.",
      "acceptanceCriteria": [
        "From a logged-in session, clicking “Generate Proposals” on /generate does not crash the app and no React error overlay appears.",
        "After generation completes, the “Generated Content” section renders with all four output sections (Upwork Proposal, Cold Email Pitch, Short DM Pitch, Pricing Breakdown).",
        "No runtime exceptions occur from numeric comparisons/conversions related to entitlements or proposal generation state (e.g., BigInt vs number issues)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/generate/GenerateForm.tsx",
          "operation": "modify",
          "description": "Fix Generate gating and submit flow to avoid BigInt/number comparison crashes by relying on normalized entitlement numbers and ensuring Generate button disable logic is derived from safe numeric values. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Adjust proposal generation mutation success handling to ensure entitlement cache invalidation and UI refresh are stable after generation, with entitlements returned in a normalized UI-safe shape used by /generate. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/generate/GeneratedOutputs.tsx",
          "operation": "modify",
          "description": "Confirm generated output rendering and edit propagation remain stable when output updates after generation; ensure no state updates can lead to rendering invalid (e.g., undefined sections). Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-11",
      "summary": "Normalize subscription/entitlements numeric values across the UI and update Generate gating and quota display logic accordingly.",
      "acceptanceCriteria": [
        "All places that compute `canGenerate` or compare remaining generations work without throwing (including when remaining generations are returned as BigInt-like values from the backend bindings).",
        "Quota UI (Generate page banner) correctly shows remaining generations and updates after a successful generation without errors.",
        "Account/Upgrade plan UI correctly shows remaining free generations and total generations without errors."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/number.ts",
          "operation": "create",
          "description": "Add shared numeric normalization helpers for UI (e.g., safe conversion from bigint/unknown to number with predictable fallbacks) to prevent runtime errors in comparisons and rendering."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Normalize entitlements returned from getUserSubscriptionStatus by (1) using the correct plan value (string enum) and (2) converting remainingFreeGenerations/totalGenerations to UI-safe numbers via shared helpers, so all consumers can compare/render without BigInt issues. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/generate/QuotaBanner.tsx",
          "operation": "modify",
          "description": "Update quota banner to use normalized numeric entitlements values (no direct BigInt to Number assumptions in render) and keep messaging correct for Free vs Premium users. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/account/PlanCard.tsx",
          "operation": "modify",
          "description": "Update account plan/usage UI to use normalized numeric entitlements values for remaining and total generations, avoiding BigInt rendering/comparison pitfalls. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/dashboard/SavedProposalsList.tsx",
          "operation": "modify",
          "description": "Harden timestamp-to-date rendering by using shared numeric normalization helpers when converting bigint timestamps to numbers, preventing potential runtime issues on large values. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/ProposalDetailPage.tsx",
          "operation": "modify",
          "description": "Harden proposal detail timestamp-to-date rendering by using shared numeric normalization helpers when converting bigint timestamps to numbers, preventing potential runtime issues on large values. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-12",
      "summary": "Add a minimal manual QA checklist regression pass for Generate, quota behavior, and saved proposal flows.",
      "acceptanceCriteria": [
        "Manual QA confirms: (1) Free user can generate until quota is exhausted; (2) quota decrements by 1 per generation; (3) when exhausted, user cannot generate and sees the appropriate messaging; (4) Premium user can generate without limits; (5) Saving a generated proposal works and it appears on Dashboard; (6) Viewing a saved proposal detail works; (7) Deleting a saved proposal works.",
        "No new backend traps are triggered unexpectedly during normal usage (other than intended authorization/quota traps)."
      ],
      "file_operations": [
        {
          "path": "frontend/QA-MANUAL.md",
          "operation": "create",
          "description": "Create a concise manual QA checklist covering Generate flow, quota decrementing/exhaustion messaging, Premium unlimited behavior, save-to-dashboard, proposal detail view, and delete flow, including a quick sanity check for no runtime errors."
        }
      ]
    }
  ]
}